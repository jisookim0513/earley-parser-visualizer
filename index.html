<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title>CS164 Final Proj Ex1: JVM</title>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="http://documentcloud.github.com/underscore/underscore-min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <style src="graph.css"></style>
    <style>
    #left { 
       width:w; 
       height:h; 
       float:left; 
       padding-top:10px;
    }

    #right { 
       width:w; 
       height:h; 
       float:left;
       padding-left:20px;
    }
    </style>
  </head>
  <div id='root'></div>
    <!-- Temporarily textbox for user input -->
  <div id="left">
    <div id='inputline' style="font-family: sans-serif; font-size: 12px;">
      Enter your input here : <input type="textbox" id="userinput" value="input 1+2*3" style="width: 600px"></input>
      <button id="Get">Enter</button> 
    </div>
    <div style="font-family: sans-serif; font-size: 18px;">
      <p id="errormessage" style="color: #ff0000;"></p>
    </div>
  </div>

  <div id="right">
      <ul id="assocs">
        <li>M</li>
      </ul>
    <div id="grammars">
    </div>
  </div>

  <body>
    <script type="text/javascript" src="graph.js"></script>
    <script type="text/javascript" src="interpreter.js"></script>
    <script type="text/javascript" src="parser.js"></script>
    <script type="text/javascript">
      //the current graph being displayed

      // width and height of svg
      var w = 1024;
      var h = 400;
      var circleDist = 150;
      var svg = d3.select("body").append("svg").attr("width", w).attr("height", h);

      var root = d3.select('#inputline')
      
      // creates a back button that calls stepBack with nowgraph
      root.append('button')
        .text('Back')
        .on('click', function() {  stepBack(nowgraph); });

      // creates a forward button that calls stepForward with nowgraph
      root.append('button')
        .text('Forward')
        .on('click', function() { stepForward(nowgraph); });

      // Receive input from REPL, parse it into AST
      function handleUserInput(text){
        try {
          var ast = parse(text);
          var obj = eval(ast); // Returns an object if ast is type input. Otherwise null
          setErrorMessage("");
        } catch (err){
          setErrorMessage(err.message);
        }
        if (obj){
          var grammars = obj.grammars;
          var input = obj.input;
          var earleyResult = earleyParse(grammars, input);
          nowgraph = new Graph(earleyResult.edges, earleyResult.nodes, earleyResult.initEdges);
          drawGraph(nowgraph);
        }

      }

      // Calls Jisoo's parser
      function parse(text){
        console.log(parseInput(text));
        return parseInput(text);
      }

      // Calls Vivian;s earley parser
      function earleyParse(gramars, input){
        switch(input) {
          case "1+1":
            return {"nodes": [0,1,2,3], "edges": [[0,1,"E->Id"], [0,1,"Id->1"], [2,3,"E->Id"], [2,3,"Id->1"], [0,3,"E->E+E"]], "initEdges": [[0,1,"1"], [1,2,"+"], [2,3,"1"]]};
          case "1+2*3":
            return {"nodes": nodelist, "edges": steplist, "initEdges": initEdgeList};
          default:
            return {"nodes": [], "edges":[]};
        }
      }
      
      var nodelist = [0, 1, 2, 3, 4, 5];
      var initEdgeList = [[0,1,"1"], [1,2,"+"], [2,3,"2"], [3,4,"*"], [4,5,"3"]];
      var steplist = [[0,1,"E->Id"], [0,1,"Id->1"], [2,3,"E->Id"], [2,3,"Id->2"], [4,5,"E->Id"], [4,5,"Id->3"], [0,3,"E->E+E"], [2,5,"E->E*E"], [0,5,"E->E+E"], [0,5,"E->E*E"]];
      var nowgraph = new Graph([], [], []);      
    </script>
    
    <script>
      function setErrorMessage(msg){
        document.getElementById("errormessage").innerHTML = msg;
      }

      function displayAssocs(){ 
        var elements = [];
        $.each(data, function(i, item) {
          items.push('<li><a href="yourlink?id=' + item.UserID + '">' + item.Username + '</a></li>');
         });  // close each()
        $('#right > #assocs').add("BITCH");
      }

      function setupTextBox(){
        $("button:#Get").click(function () {
          handleUserInput($('#userinput').val());
        });
      }

      $(document).ready(setupTextBox);

    </script>

  </body>

</html>